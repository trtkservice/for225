# 🤖 Nikkei 225 LiL Flexx Bot (v2.2)

## 1. プロジェクトの目的 (Project Goal)
本プロジェクトは、**日経225** を対象とした、統計的優位性に基づく自動売買システムの構築を目的としています。
**「LiL Flexx（リル・フレックス）」** とは、市場の柔軟性（Flexibility）を味方につけ、どんな相場状況でもしなやかに利益を積み上げることを目指すコンセプトネームです。

現在は **フェーズ1（シャドートレーディング）** として、GitHub Actions上で **Multiverseテスト（過去最強の10戦略の競争）** を行い、リアルタイムフォワードテストで「最強の設定」を特定しています。

---

## 2. システムアーキテクチャ (Core Logic)

本システムの中核となる **LiL Flexx Engine v2.2** は、以下の高度な分析機能を備えたPythonアプリケーションです。

### 🧠 LiL Flexx Engine (分析エンジン)
市場データを物理学的なメタファー（Trend, Momentum, Volatility）に加え、**形状認識（Pattern Recognition）** で解析します。

| レイヤー | 名称 | 使用指標 | 役割 |
|:---:|:---:|:---|:---|
| **Layer 1** | **🌊 Trend** | EMA (20, 50, 200) | 大局的なトレンド方向（上昇/下降）を判定 |
| **Layer 2** | **🚀 Momentum** | RSI (14), MACD | 短期的な勢いと、**ダイバージェンス（逆行現象）** を検知して天井/底を回避 |
| **Layer 3** | **🕯️ Patterns** | Candlestick Analysis | **ピンバー・包み足** などのプライスアクションを認識し、ダマシをフィルタリング |
| **Layer 4** | **⚠️ Volatility** | VIX Index | 市場の恐怖指数を監視し、危険な相場（VIX>30）を回避 |

### 🌌 Multiverse Testing（多重世界検証）
現在、単一の戦略ではなく、バックテストで上位成績を収めた **10種類の異なるパラメーター設定** を同時に並行稼働させています。

*   **共通設定**: DAYトレード（引け決済）、初期資金10万円、2枚運用
*   **変動パラメーター**: Stop幅 (0.4 ~ 0.6) / Target幅 (1.2 ~ 3.0)
*   **目的**: バックテスト（過去）だけでなく、フォワードテスト（現在進行系の未来）において、どの設定が最も頑健（Robust）であるかを実証実験すること。

---

## 3. インフラストラクチャ (Infrastructure)

本プロジェクトは **「フェーズ1：サーバーレス」** と **「フェーズ2：Windows VPS」** の2段階構成です。

### ⚙️ Phase 1: GitHub Actions (Current)
現在はコストゼロで検証を行うため、GitHub Actions上で運用されています。

1.  **Daily Prediction (`src/nikkei_bot.py`)**:
    *   毎日 **08:00 JST** と **16:00 JST** に定期実行。
    *   市場データの取得 → AI分析 → **10種類の戦略で仮想売買** → 結果記録を一気通貫で行います。
    
2.  **Dashboard Generation**:
    *   取引結果をWebダッシュボード (`dashboard.html`) に即時反映。
    *   [View Dashboard](https://trtkservice.github.io/for225/data/dashboard.html)

### 🏢 Phase 2: Windows VPS (Future / Go-Live)
本番運用（リアルマネー投入）時は、安定性と証券会社のツール制約のため、Windows VPSへ移行し、楽天RSSを利用した完全自動発注を行います。

---

## 4. 運用実績 (Backtest Verification)

### 最新バックテスト結果 (2021-2026)
*   期間: 直近5年間 (厳密なコスト計算: スプレッド5円/手数料75円 適用済み)
*   ロジック: LiL Flexx v2.2 (Day Trade Mode)
*   **Best Strategy**: Stop 0.4 / Target 3.0
    *   **Total Return**: **+127%**
    *   **Profit Factor**: **1.36**
    *   **Max Drawdown**: **19.7%** (資金20%のリスクで資産2.2倍)

---

## 5. FAQ (よくある質問)

**Q. 運用枚数は何枚ですか？証拠金は別途必要？**  
A. 全戦略で **「2枚」** 設定です。証拠金は運用資金（10万円）に含まれている計算ですので、別途用意する必要はありません。10万円の範囲内で、「証拠金拘束」と「ドローダウン耐え」の両方を賄う設計です。

**Q. 判定ロジックを見るにはどのファイルを見ればいい？**  
A. `src/nikkei_bot.py` が全てです。この中の `LiLFlexxEngine` クラスに、トレンド判定、パターン認識、スコア計算の全ロジックが集約されています。

**Q. バックテストのやり方は適切？**  
A. 適切かつ、かなり厳しめです。yfinanceの信頼できるデータを使用し、さらに実運用で発生する「スプレッド（価格差）」と「手数料」をかなり高め（1トレードあたり実質125円コスト相当）に見積もって計算しています。それでも利益が出ているため、データの信頼性は高いと言えます。

# バックテスト実行
python backtest_runner.py
```

---
© 2026 Antigravity Project
